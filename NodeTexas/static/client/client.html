<!DOCTYPE html>
<html>

	<head>
		<meta http-equiv="content-type" />
		<meta charset="UTF-8">
		<link rel="icon" href="//localhost:8080/favicon.icon" type="image/x-icon" />
		<link rel="stylesheet" href="css/reset.css" />
		<link rel="stylesheet" type="text/css" href="css/poker.css"/>
		<title></title>
	</head>

	<body>
		<button _method='get' class="btn_get">get</button>
		<button class="btn_post">post</button>
		<button class="btn_put">put</button>
		<button class="btn_delete">delete</button>
		<fieldset>
			<legend>框框</legend>
			<div class='login-box'>
				<input type="text" name="uid" id="user_uid" value="" placeholder="account" />
				<input type="password" name="pwd" id="user_pwd" value="" placeholder="password" />
				<button class="signUp">注册</button>
				<button class="login">登录</button>
			</div>

			<div class="welcome">
				请登录
			</div>
		</fieldset>
			
			<div class="game">
				<div class="stage">

			
			<div class="banker">

			</div>
			<div class="table">

			</div>
			<div class='players'>

			</div>
		<button class="start">开始游戏</button>
			
		</div>

		<div class="ask">
			<div class="ask-msg">
				<p>提示</p>
			</div>
			<div class="sel">
				<button data-btn='follow' class="sel-btn_follow">跟</button>
				<button data-btn='add' class="sel-btn_add">加注</button>
				<button data-btn='allin' class="sel-btn_allin">allin</button>
				<button data-btn='fold' class="sel-btn_fold">盖牌</button>
			</div>
		</div>
			</div>
	</body>
	<script src="../ajax.js" type="text/javascript">
	</script>
	<!--自动登录-->
	<!--<script src="test_client.js" type="text/javascript">
		
	</script>-->
	<script type="text/javascript">
		function getCookie(cookieName) {
			var strCookie = document.cookie;
			var arrCookie = strCookie.split("; ");
			for(var i = 0; i < arrCookie.length; i++) {
				var arr = arrCookie[i].split("=");
				if(cookieName == arr[0]) {
					return arr[1];
				}
			}
			return "";
		}
		var $ = _ => document.querySelector(_)
		// 自动登录  刷新本页还是 redirect

		// 区分是否登录
		let _isLogin = getCookie('isLogin'),
			_token = getCookie('token')

		if(_isLogin && _token) {
			// 校验
			ajax({
				url: '//localhost:8080/api/v1/login'
			}).then(r => {
				console.log('auto login:' + r)
				r = JSON.parse(r)
				if(r.code == 200) {
					//登录特化
					$('.welcome').innerText = `你已经登录了! 欢迎你  uid ${r.uid}, 你上一次登录是 : ${r.lastLogin}`
					$('.login-box').style.display = 'none'
				}
			})
		}

		$('.btn_get').onclick = () => {
			ajax({
				url: '//localhost:8080/api/v1/player',
				data: {
					uid: 199
				}
			}).then(r => {
				console.log('get:' + r)
			})
		}
		$('.btn_post').onclick = () => {
			ajax({
				method: 'post',
				url: '//localhost:8080/api/v1/player',
				data: {
					uid: ~~(Math.random() * 100)
				}
			}).then(r => {
				console.log('post:' + r)
			})
		}
		$('.btn_put').onclick = () => {
			ajax({
				method: 'put',
				url: '//localhost:8080/api/v1/player',
				data: {
					uid: 87,
					chip: -20
				}
			}).then(r => {
				console.log('put:' + r)
			})
		}
		$('.btn_delete').onclick = () => {
			ajax({
				method: 'delete',
				url: '//localhost:8080/api/v1/player',
				data: {
					uid: 199
				}
			}).then(r => {
				console.log('delet:' + r)
			})
		}

		$('.signUp').onclick = () => {
			let uid = $('#user_uid').value,
				pwd = $('#user_pwd').value
			ajax({
				method: 'post',
				url: '//localhost:8080/api/v1/signUp',
				data: {
					uid: uid,
					pwd: pwd
				}
			}).then(r => {
				console.log(uid, pwd)
				console.log('signUp:' + r)
			})
		}
		$('.login').onclick = () => {
			let uid = $('#user_uid').value,
				pwd = $('#user_pwd').value
			ajax({
				method: 'post',
				url: '//localhost:8080/api/v1/login',
				data: {
					uid: uid,
					pwd: pwd
				}
			}).then(r => {
				console.log('login:' + r)
				if(r.code == 200) {
					alert('login!')
				}
			})
		}

		function addUser(num) {
			for(let i = 3; i > 0; i--) {
				ajax({
					method: 'post',
					url: '//localhost:8080/api/v1/player',
					data: {
						uid: ~~(Math.random() * 100),
						pwd: 'default'
					}
				}).then(r => {
					console.log('post:' + r)
				}).catch(err => {
					console.error(err)
				})
			}
		}
	</script>

</html>